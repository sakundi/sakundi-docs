"use strict";(self.webpackChunktikuna=self.webpackChunktikuna||[]).push([[701],{5680:(e,n,a)=>{a.d(n,{xA:()=>d,yg:()=>y});var r=a(6540);function i(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function t(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?t(Object(a),!0).forEach((function(n){i(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function l(e,n){if(null==e)return{};var a,r,i=function(e,n){if(null==e)return{};var a,r,i={},t=Object.keys(e);for(r=0;r<t.length;r++)a=t[r],n.indexOf(a)>=0||(i[a]=e[a]);return i}(e,n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(r=0;r<t.length;r++)a=t[r],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var c=r.createContext({}),s=function(e){var n=r.useContext(c),a=n;return e&&(a="function"==typeof e?e(n):o(o({},n),e)),a},d=function(e){var n=s(e.components);return r.createElement(c.Provider,{value:n},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},g=r.forwardRef((function(e,n){var a=e.components,i=e.mdxType,t=e.originalType,c=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=s(a),g=i,y=u["".concat(c,".").concat(g)]||u[g]||p[g]||t;return a?r.createElement(y,o(o({ref:n},d),{},{components:a})):r.createElement(y,o({ref:n},d))}));function y(e,n){var a=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var t=a.length,o=new Array(t);o[0]=g;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l[u]="string"==typeof e?e:i,o[1]=l;for(var s=2;s<t;s++)o[s]=a[s];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}g.displayName="MDXCreateElement"},7176:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>t,metadata:()=>l,toc:()=>s});var r=a(8168),i=(a(6540),a(5680));const t={id:"using-zikuani-third-party",title:"Usando Zikuani como proveedor",sidebar_label:"Usando Zikuani como proveedor",description:"Sakundi - Usando Zikuani como proveedor",keywords:["sakundi","zikuani","identity","wallet"],hide_table_of_contents:!0,custom_edit_url:null},o="\ud83e\uddea Tutorial: C\xf3mo integrar c\xf3digo del cliente con el Wallet Zikuani para obtener pruebas an\xf3nimas de identidad",l={unversionedId:"user-section/using-zikuani-third-party",id:"user-section/using-zikuani-third-party",title:"Usando Zikuani como proveedor",description:"Sakundi - Usando Zikuani como proveedor",source:"@site/i18n/es/docusaurus-plugin-content-docs/current/user-section/using-zikuani-third-party.md",sourceDirName:"user-section",slug:"/user-section/using-zikuani-third-party",permalink:"/es/docs/user-section/using-zikuani-third-party",draft:!1,editUrl:null,tags:[],version:"current",frontMatter:{id:"using-zikuani-third-party",title:"Usando Zikuani como proveedor",sidebar_label:"Usando Zikuani como proveedor",description:"Sakundi - Usando Zikuani como proveedor",keywords:["sakundi","zikuani","identity","wallet"],hide_table_of_contents:!0,custom_edit_url:null},sidebar:"tutorialSidebar",previous:{title:"Instalaci\xf3n del Wallet",permalink:"/es/docs/user-section/client-installation"},next:{title:"\xbfQu\xe9 es ZK Voto Digital?",permalink:"/es/docs/user-section/what-is-zk-voto-digital"}},c={},s=[{value:"\ud83d\udce6 1. Configuraci\xf3n del Proyecto",id:"-1-configuraci\xf3n-del-proyecto",level:2},{value:"Librer\xedas necesarias",id:"librer\xedas-necesarias",level:3},{value:"\ud83d\udd10 2. Configuraci\xf3n del Entorno",id:"-2-configuraci\xf3n-del-entorno",level:2},{value:"\ud83e\uddfe 3. Funci\xf3n para Decodificar JWT",id:"-3-funci\xf3n-para-decodificar-jwt",level:2},{value:"\ud83d\udeaa 4. Ruta Principal <code>/login</code>",id:"-4-ruta-principal-login",level:2},{value:"\ud83d\udd04 5. Ruta de Callback <code>/callback</code>",id:"-5-ruta-de-callback-callback",level:2},{value:"Paso 1: Validar el c\xf3digo",id:"paso-1-validar-el-c\xf3digo",level:3},{value:"Paso 2: Intercambiar el c\xf3digo por un token de acceso",id:"paso-2-intercambiar-el-c\xf3digo-por-un-token-de-acceso",level:3},{value:"Paso 3: Si se autentica correctamente, usar los datos del token y la credencial verificable obtenido",id:"paso-3-si-se-autentica-correctamente-usar-los-datos-del-token-y-la-credencial-verificable-obtenido",level:3},{value:"\ud83d\ude80 6. Iniciar el servicio del cliente",id:"-6-iniciar-el-servicio-del-cliente",level:2},{value:"\u2705 Resumen",id:"-resumen",level:2},{value:"Mira el ejemplo completo en el siguiente enlace:",id:"mira-el-ejemplo-completo-en-el-siguiente-enlace",level:2}],d={toc:s},u="wrapper";function p(e){let{components:n,...a}=e;return(0,i.yg)(u,(0,r.A)({},d,a,{components:n,mdxType:"MDXLayout"}),(0,i.yg)("h1",{id:"-tutorial-c\xf3mo-integrar-c\xf3digo-del-cliente-con-el-wallet-zikuani-para-obtener-pruebas-an\xf3nimas-de-identidad"},"\ud83e\uddea Tutorial: C\xf3mo integrar c\xf3digo del cliente con el Wallet Zikuani para obtener pruebas an\xf3nimas de identidad"),(0,i.yg)("p",null,"Este tutorial explica c\xf3mo crear un cliente Web (Javascript) usando ",(0,i.yg)("inlineCode",{parentName:"p"},"Express.js"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"axios")," para autenticarse y recibir una ",(0,i.yg)("strong",{parentName:"p"},"credencial verificable")," usando pruebas de conocimiento cero. Al final el cliente puede recibir una prueba irrefutable de identidad del usuario sin necesidad de exponer datos personales sensibles."),(0,i.yg)("hr",null),(0,i.yg)("h2",{id:"-1-configuraci\xf3n-del-proyecto"},"\ud83d\udce6 1. Configuraci\xf3n del Proyecto"),(0,i.yg)("h3",{id:"librer\xedas-necesarias"},"Librer\xedas necesarias"),(0,i.yg)("p",null,"Instala las dependencias:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"npm install express axios querystring\n")),(0,i.yg)("hr",null),(0,i.yg)("h2",{id:"-2-configuraci\xf3n-del-entorno"},"\ud83d\udd10 2. Configuraci\xf3n del Entorno"),(0,i.yg)("p",null,"La app obtiene configuraciones desde variables de entorno, con valores por defecto:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},'// Secrets\nconst CLIENT_ID = process.env.REACT_APP_CLIENT_ID || "hello@example.com";\nconst CLIENT_SECRET = process.env.REACT_APP_CLIENT_SECRET || "password";\nconst REDIRECT_URI = process.env.REACT_APP_REDIRECT_URI || "http://localhost:3000/callback";\nconst AUTH_SERVER_URL = process.env.REACT_APP_AUTH_SERVER_URL || "https://app.sakundi.io";\nconst ACCOUNT = process.env.ACCOUNT || "user@usermail.com";\n')),(0,i.yg)("hr",null),(0,i.yg)("h2",{id:"-3-funci\xf3n-para-decodificar-jwt"},"\ud83e\uddfe 3. Funci\xf3n para Decodificar JWT"),(0,i.yg)("p",null,"Esta funci\xf3n decodifica un JWT (Base64URL) que contiene un token:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"function parseJwt(token) {\n    try {\n        // Split the token into its parts (Header, Payload, Signature)\n        const base64Url = token.split('.')[1];\n        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n        const jsonPayload = decodeURIComponent(\n            atob(base64)\n                .split('')\n                .map((c) => {\n                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n                })\n                .join('')\n        );\n\n        return JSON.parse(jsonPayload);\n    } catch (error) {\n        console.error('Invalid token:', error);\n        return null;\n    }\n}\n")),(0,i.yg)("hr",null),(0,i.yg)("h2",{id:"-4-ruta-principal-login"},"\ud83d\udeaa 4. Ruta Principal ",(0,i.yg)("inlineCode",{parentName:"h2"},"/login")),(0,i.yg)("p",null,"Muestra una p\xe1gina con un enlace para iniciar la autenticaci\xf3n:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},'  app.get(\'/login\', (req, res) => {\n      // Step 1: Redirect user to the OAuth server for authorization\n      const authUrl = `${AUTH_SERVER_URL}/authorize?` + querystring.stringify({\n          grant_type: "code",\n          client_id: CLIENT_ID,\n          user_id: ACCOUNT,\n          redirect_uri: REDIRECT_URI,\n          scope: "zk-firma-digital",        state: String(Math.floor(Math.random() * 10000)),\n          nullifier_seed: 1000\n      });\n      res.send(`\n          <h1>Autent\xedquese con su Firma Digital</h1>\n          <p><a href="${authUrl}">Haga click en el enlance para comenzar el proceso de autenticaci\xf3n</a></p>\n      `);\n  });\n')),(0,i.yg)("p",null,"Esto redirige al usario al servicio de Sakundi que posteriormente activa el Wallet de Zikuani."),(0,i.yg)("hr",null),(0,i.yg)("h2",{id:"-5-ruta-de-callback-callback"},"\ud83d\udd04 5. Ruta de Callback ",(0,i.yg)("inlineCode",{parentName:"h2"},"/callback")),(0,i.yg)("p",null,"Maneja el retorno del servidor de Backend del Wallet de Zikuani:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"app.get('/callback', async (req, res) => {\n  const { code, state } = req.query;\n")),(0,i.yg)("h3",{id:"paso-1-validar-el-c\xf3digo"},"Paso 1: Validar el c\xf3digo"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"  if (!code) return res.status(400).send('Se requiere c\xf3digo de autenticaci\xf3n');\n")),(0,i.yg)("h3",{id:"paso-2-intercambiar-el-c\xf3digo-por-un-token-de-acceso"},"Paso 2: Intercambiar el c\xf3digo por un token de acceso"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"  const response = await axios.post(\\`\\${AUTH_SERVER_URL}/token\\`,\n    querystring.stringify({\n      code,\n      client_id: CLIENT_ID,\n      client_secret: CLIENT_SECRET,\n      redirect_uri: REDIRECT_URI,\n      grant_type: 'authorization_code'\n    }),\n    {\n      headers: { 'Content-Type': 'application/x-www-form-urlencoded' }\n    }\n  );\n")),(0,i.yg)("h3",{id:"paso-3-si-se-autentica-correctamente-usar-los-datos-del-token-y-la-credencial-verificable-obtenido"},"Paso 3: Si se autentica correctamente, usar los datos del token y la credencial verificable obtenido"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"    const { access_token, token_type, expires_in, verifiable_credential } = response.data;\n\n    // Display the access token\n    res.send(`\n        <html>\n        <head>\n            <title>Token Recibido</title>\n            <style>\n            body { font-family: sans-serif; padding: 2em; line-height: 1.5; }\n            h1 { color: #2c3e50; }\n            pre { background: #f4f4f4; padding: 1em; border-radius: 4px; overflow-x: auto; }\n            </style>\n        </head>\n        <body>\n            <h1>\xa1Token de acceso recibido!</h1>\n            <p><strong>Tipo de Token:</strong> ${token_type}</p>\n            <p><strong>Expira en:</strong> ${expires_in} minutos</p>\n            <p><strong>Token:</strong></p>\n            <pre>${JSON.stringify(parseJwt(access_token), null, 2)}</pre>\n            <p><strong>Credencial verificable con prueba ZK:</strong></p>\n            <pre>${JSON.stringify(verifiable_credential, null, 2)}</pre>\n        </body>\n        </html>\n    `);\n")),(0,i.yg)("hr",null),(0,i.yg)("h2",{id:"-6-iniciar-el-servicio-del-cliente"},"\ud83d\ude80 6. Iniciar el servicio del cliente"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"const PORT = process.env.PORT || 3000;\napp.listen(PORT, () => {\n  console.log(\\`Cliente OAuth ejecut\xe1ndose en http://localhost:\\${PORT}\\`);\n});\n")),(0,i.yg)("hr",null),(0,i.yg)("h2",{id:"-resumen"},"\u2705 Resumen"),(0,i.yg)("p",null,"Esta app:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Redirige al usuario para autenticarse con un servidor de Backend del Wallet de Zikuani"),(0,i.yg)("li",{parentName:"ul"},"Maneja el ",(0,i.yg)("inlineCode",{parentName:"li"},"callback")," con un c\xf3digo de autorizaci\xf3n"),(0,i.yg)("li",{parentName:"ul"},"Intercambia el c\xf3digo por un token de acceso y una credencial verificable"),(0,i.yg)("li",{parentName:"ul"},"Usa los detalles del token y credencial en el navegador, mostrandolos")),(0,i.yg)("p",null,"En un caso de uso de la vida real, el VC se usaria para permitir el acceso del usuario a un servicio\nespec\xedfico, basado en la garant\xeda de la nacionalidad del usuario y la edad por ejemplo."),(0,i.yg)("hr",null),(0,i.yg)("h2",{id:"mira-el-ejemplo-completo-en-el-siguiente-enlace"},"Mira el ejemplo completo en el siguiente enlace:"),(0,i.yg)("p",null,(0,i.yg)("a",{parentName:"p",href:"https://github.com/sakundi/zikuani-boilerplate"},"https://github.com/sakundi/zikuani-boilerplate")))}p.isMDXComponent=!0}}]);